/* His name was Bruce McNair. Copyright 2025 City of Vernonia, Oregon. */
import{__awaiter as e,__decorate as t}from"tslib";import{watch as i,whenOnce as o}from"@arcgis/core/core/reactiveUtils";import{property as r,subclass as s}from"@arcgis/core/core/accessorSupport/decorators";import l from"@arcgis/core/widgets/Sketch/SketchViewModel";import n from"@arcgis/core/views/interactive/snapping/SnappingOptions";import a from"@arcgis/core/views/interactive/snapping/FeatureSnappingLayerSource";import p from"@arcgis/core/layers/GroupLayer";import c from"@arcgis/core/layers/GraphicsLayer";import h from"@arcgis/core/Graphic";import y from"@arcgis/core/symbols/CIMSymbol";import d from"@arcgis/core/symbols/SimpleFillSymbol";import m from"@arcgis/core/symbols/SimpleLineSymbol";import S from"@arcgis/core/symbols/SimpleMarkerSymbol";import g from"@arcgis/core/symbols/TextSymbol";import{APPLICATION_SKETCH_LAYER as w}from"../../support/layerUtils";export const COLORS={white:[255,255,255],black:[0,0,0],grey:[128,128,128],red:[237,81,81],blue:[20,158,206],green:[167,198,54],purple:[158,85,156],orange:[252,146,31],yellow:[255,222,62]};const f=new y({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[4.75,4.75],lineDashEnding:"HalfPattern",offsetAlongLine:0}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:2.25,color:[...COLORS.white,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:2.25,color:[...COLORS.red,255]}]}}}),u=new S({style:"circle",size:6,color:COLORS.yellow,outline:{width:1,color:COLORS.red}}),O="sketch-custom-handles";export const POINT_SYMBOL=new S({style:"circle",size:8,color:COLORS.yellow,outline:{width:1,color:COLORS.red}});const b=new d({color:[...COLORS.yellow,.125],outline:{color:COLORS.red,width:2}}),L=new m({color:COLORS.red,width:2}),C=new S({style:"circle",size:6,color:COLORS.white,outline:{width:1,color:COLORS.red}}),x=new n({enabled:!0,featureEnabled:!0,selfEnabled:!0});export const TEXT_SYMBOL=new g({color:COLORS.red,haloColor:COLORS.white,haloSize:2,horizontalAlignment:"center",text:"New Text",verticalAlignment:"middle",font:{size:12}});let v=class extends l{constructor(t){super(t),this.graphicsCount=0,this.layer=new c,this.layers=new p({listMode:"hide"}),this.point=new c({title:"point"}),this.polygon=new c({title:"polygon"}),this.polyline=new c({title:"polyline"}),this.text=new c({title:"text"}),this.textSymbol=TEXT_SYMBOL,this.updateOnGraphicClick=!1,this.activeFillSymbol=b,this.activeLineSymbol=f,this.activeVertexSymbol=u,this.pointSymbol=POINT_SYMBOL,this.polygonSymbol=b,this.polylineSymbol=L,this.snappingOptions=x,this.vertexSymbol=C;const r=[this.polygon,this.polyline,this.point,this.text];this.layers.addMany([...r,this.layer]),o(()=>this.view).then(t=>e(this,void 0,void 0,function*(){if(!t||!t.map)return;yield t.when(),w?w.add(this.layers):t.map.add(this.layers);const e=t.map.layers;r.forEach(this._addSnappingLayer.bind(this)),e.forEach(this._addSnappingLayer.bind(this)),this.addHandles(e.on("after-add",e=>{this._addSnappingLayer(e.item)}),O),this.pointView=yield t.whenLayerView(this.point),this.polygonView=yield t.whenLayerView(this.polygon),this.polylineView=yield t.whenLayerView(this.polyline),this.textView=yield t.whenLayerView(this.text)})),this.addHandles(r.map(e=>i(()=>e.graphics.length,()=>{this.graphicsCount=this.polygon.graphics.length+this.polyline.graphics.length+this.point.graphics.length+this.text.graphics.length})),O)}addGeometry(e){const{type:t}=e;if("point"!==t&&"polygon"!==t&&"polyline"!==t)return;const i=new h({geometry:e,symbol:this[`${t}Symbol`]});return this[t].add(i),i}addJSON(e){const t=h.fromJSON(e),{geometry:i,symbol:o}=t;if(!o)return this.addGeometry(i);const r=t.symbol.type,s=t.geometry.type;return"point"===s||"polygon"===s||"polyline"===s?("text"===r?this.text.add(t):this[s].add(t),t):void 0}deleteAll(){const{layers:{layers:e}}=this;e.forEach(e=>{e.removeAll()})}featureJSON(){const{point:e,polygon:t,polyline:i,text:o}=this,r=[];return[e,i,t,o].forEach(e=>{e.graphics.forEach(e=>{r.push(e.toJSON())})}),{features:r}}_addSnappingLayer(e){const{snappingOptions:{featureSources:t}}=this,{listMode:i,title:o,type:r}=e;if("group"===r)return void e.layers.forEach(this._addSnappingLayer.bind(this));if(!0===e.internal)return;if("hide"===i||!o)return;if("graphics"!==r&&"csv"!==r&&"feature"!==r&&"geojson"!==r)return;const s=e;t.add(new a({layer:s}))}};t([r()],v.prototype,"graphicsCount",void 0),v=t([s("cov.components.Sketch.Sketch")],v);export default v;