/* His name was Bruce McNair. Copyright 2025 City of Vernonia, Oregon. */
import{__decorate as e}from"tslib";import{subclass as t,property as i}from"@arcgis/core/core/accessorSupport/decorators";import a from"@arcgis/core/widgets/Widget";import{tsx as o}from"@arcgis/core/widgets/support/widget";import{publish as c}from"pubsub-js";import{SHOW_ALERT_TOPIC as s}from"../MapApplication";const r="cov-sketch-load-form",n="cov-sketch-save-form";let l=class extends a{get container(){return this._container}set container(e){this._container=e}constructor(e){super(e),this._container=document.createElement("calcite-dialog"),this._viewState="save",this.container=this._container,document.body.appendChild(this.container),this.container.addEventListener("calciteDialogClose",(()=>{this._viewState="save"}))}_close(){const{container:e}=this;e.open=!1}_load(e){e.preventDefault();const t=this.container.querySelector(`#${r}`),i=t.querySelector("calcite-input");if(!i.files||!i.files[0])return void i.setFocus();let{_reader:a}=this;a||(a=this._reader=new FileReader,a.onload=this._readerLoad.bind(this,t),a.onerror=this._readerError.bind(this));const o=i.files[0];a.readAsText(o)}_readerLoad(e){var t;const{sketch:i,_reader:a}=this;if(!a)return;e.reset(),i.deleteAll();const{features:o}=JSON.parse(a.result),c=o.map((e=>i.addJSON(e)));null===(t=i.view)||void 0===t||t.goTo(c),this._close()}_readerError(e){console.log(e),c(s,{icon:"exclamation-mark-triangle",kind:"danger",label:"Load Sketch Error",message:"An error occurred loading sketch graphics.",title:"Load Sketch Error"})}_save(e){e.preventDefault();const{sketch:t}=this,i=this.container.querySelector(`#${n}`).querySelector("calcite-input").value||"my_sketches";Object.assign(document.createElement("a"),{href:`data:text/plain;charset=UTF-8,${encodeURIComponent(JSON.stringify(t.featureJSON()))}`,download:`${i}.json`}).click()}render(){const{_graphicsCount:e,_viewState:t}=this,i=e<1;return o("calcite-dialog",{heading:"Save/Load Sketch Graphics",modal:!0,width:"s"},o("calcite-tabs",null,o("calcite-tab-nav",{slot:"title-group"},o("calcite-tab-title",{"icon-start":"save",selected:"save"===t,onclick:()=>{this._viewState="save"}},"Save"),o("calcite-tab-title",{"icon-start":"folder-open",selected:"load"===t,onclick:()=>{this._viewState="load"}},"Load")),o("calcite-tab",{selected:"save"===t},o("form",{id:n,onsubmit:this._save.bind(this)},o("calcite-label",{style:"--calcite-label-margin-bottom:0;"},"File name",o("calcite-input",{disabled:i,"suffix-text":".json",value:"my_sketches"}))),o("calcite-notice",{icon:"exclamation-mark-triangle",kind:"warning",open:i,style:"margin-top: 0.75rem;"},o("div",{slot:"message"},"No sketch graphics to save."))),o("calcite-tab",{selected:"load"===t},o("form",{id:r,onsubmit:this._load.bind(this)},o("calcite-label",{style:"--calcite-label-margin-bottom:0;"},"ArcGIS JSON file",o("calcite-input",{accept:".json",type:"file"}))),o("calcite-notice",{icon:"exclamation-mark-triangle",kind:"warning",open:!0,style:"margin-top: 0.75rem;"},o("div",{slot:"message"},"Existing sketch graphics will be deleted.")))),o("calcite-button",{slot:"footer-end",appearance:"outline",onclick:this._close.bind(this)},"Cancel"),o("calcite-button",{disabled:i,form:n,hidden:"save"!==t,slot:"save"===t?"footer-end":null,type:"submit",onclick:this._save.bind(this)},"Save"),o("calcite-button",{hidden:"load"!==t,slot:"load"===t?"footer-end":null,type:"submit",onclick:this._load.bind(this)},"Load"))}};e([i({aliasOf:"sketch.graphicsCount"})],l.prototype,"_graphicsCount",void 0),l=e([t("cov.components.Sketch.SketchSaveLoad")],l);export default l;