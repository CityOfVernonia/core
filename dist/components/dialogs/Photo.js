/* His name was Bruce McNair. Copyright 2024 City of Vernonia, Oregon. */
import{__awaiter as t,__decorate as e}from"tslib";import{subclass as o,property as i}from"@arcgis/core/core/accessorSupport/decorators";import n from"@arcgis/core/widgets/Widget";import{tsx as c}from"@arcgis/core/widgets/support/widget";const l=new RegExp(/https:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/);let a=class extends n{constructor(t){super(t),this.container=document.createElement("calcite-dialog"),this.showDownload=!0,this._fileName="",this._url="",this._loading=!1,document.body.append(this.container),this.container.addEventListener("calciteDialogClose",(()=>{this._url=""}))}download(e,o){return t(this,void 0,void 0,(function*(){let t=o;if(!o.match(l))return;{const e=yield(yield fetch(o)).blob();t=URL.createObjectURL(e)}const i=Object.assign(document.createElement("a"),{href:t,download:e,style:"display: none;",click:()=>{URL.revokeObjectURL(t)}});document.body.append(i),i.click(),document.body.removeChild(i)}))}show(t,e){this._fileName=t,this._url!==e&&(this._loading=!0),this._url=e,this.container.open=!0}_close(){this.container.open=!1}render(){const{showDownload:t,_fileName:e,_url:o,_loading:i}=this;return c("calcite-dialog",{heading:e,loading:i,modal:"",style:"--calcite-dialog-content-space:0;"},c("img",{style:"width:100%; min-height:300px;",src:o,afterCreate:t=>{t.addEventListener("load",(()=>{this._loading=!1}))}}),t?c("calcite-button",{appearance:"outline",slot:"footer-end",onclick:this.download.bind(this,e,o)},"Download"):null,c("calcite-button",{slot:"footer-end",onclick:this._close.bind(this)},"Close"))}};e([i()],a.prototype,"_fileName",void 0),e([i()],a.prototype,"_url",void 0),e([i()],a.prototype,"_loading",void 0),a=e([o("cov.components.dialogs.Photo")],a);export default a;