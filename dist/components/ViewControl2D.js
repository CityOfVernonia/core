/* His name was Bruce McNair. Copyright 2025 City of Vernonia, Oregon. */
import{__awaiter as e,__decorate as i}from"tslib";import{watch as t}from"@arcgis/core/core/reactiveUtils";import{property as o,subclass as c}from"@arcgis/core/core/accessorSupport/decorators";import a from"@arcgis/core/widgets/Widget";import{tsx as n}from"@arcgis/core/widgets/support/widget";import l from"@arcgis/core/widgets/Home/HomeViewModel";import s from"@arcgis/core/widgets/Zoom/ZoomViewModel";import{getCurrentPosition as r,supported as d}from"@arcgis/core/widgets/support/geolocationUtils.js";import m from"@arcgis/core/geometry/Point";import g from"@arcgis/core/symbols/SimpleMarkerSymbol";import u from"@arcgis/core/Graphic";import{referenceElement as p}from"./support";const f="cov--view-control-2d",h={base:f,actions:`${f}_actions`};let b=class extends a{constructor(e){super(e),this.includeFullscreen=!1,this.includeLocate=!1,this.includeMagnifier=!1,this._fullscreen=!1,this._locateState="ready"}postInitialize(){const{magnifierProperties:e,view:i,view:{magnifier:t}}=this;this._home=new l({view:i}),this._zoom=new s({view:i}),document.fullscreenElement&&(this._fullscreen=!0),t.visible=!1,e&&Object.assign(t,e)}_compassRotation(e){const{view:i}=this;let t;e.shadowRoot?(t=e.shadowRoot.querySelector(".icon-container"),t?(t.style.transform=`rotate(${i.rotation}deg)`,this.watch("view.rotation",()=>{t.style.transform=`rotate(${i.rotation}deg)`})):setTimeout(()=>{this._compassRotation(e)},100)):setTimeout(()=>{this._compassRotation(e)},100)}_initializeFullscreen(e){document.body.requestFullscreen?(e.addEventListener("click",()=>{const{_fullscreen:e}=this;e?document.exitFullscreen():document.body.requestFullscreen()}),document.addEventListener("fullscreenchange",()=>{this._fullscreen=!!document.fullscreenElement})):e.disabled=!0}_initializeLocate(i){return e(this,void 0,void 0,function*(){const{view:e}=this;!1===d()&&(this._locateState="disabled"),i.addEventListener("click",()=>{e.graphics.remove(this._locateGraphic),this._locateState="locating",r().then(i=>{const{latitude:t,longitude:o}=i.coords,c=new m({latitude:t,longitude:o});this._locateGraphic=new u({geometry:c,symbol:new g({color:"blue",size:12,style:"circle",outline:{color:"white",width:2}})}),e.graphics.add(this._locateGraphic),e.goTo(c),e.scale=2500,this._locateState="ready",setTimeout(()=>{e.graphics.remove(this._locateGraphic)},5e3)}).catch(e=>{console.log(e),this._locateState="ready"})}),this.addHandles(t(()=>this._locateState,e=>{i.disabled="disabled"===e,i.icon="ready"===e?"gps-on":"locating"===e?"gps-on-f":"disabled"===e?"gps-off":""}))})}_toggleMagnifier(){const{view:e,view:{magnifier:i},_magnifierHandle:t}=this;i.visible?(i.visible=!1,t&&t.remove()):(i.visible=!0,this._magnifierHandle=e.on("pointer-move",e=>{i.position={x:e.x,y:e.y}}))}render(){const{view:e,_zoom:i,_fullscreen:t,_home:o,includeLocate:c,includeFullscreen:a,includeMagnifier:l}=this,s=e.magnifier.visible,r=t?"Exit fullscreen":"Enter fullscreen",d=t?"full-screen-exit":"extent";return n("div",{class:h.base},n("div",{class:h.actions},n("calcite-action-bar",{"expand-disabled":"",floating:!0},n("calcite-action-group",null,n("calcite-action",{text:"Zoom in",icon:"plus",scale:"s",disabled:!i.canZoomIn,onclick:i.zoomIn.bind(i)}),n("calcite-tooltip",{"close-on-click":"","overlay-positioning":"fixed",afterCreate:p.bind(this)},"Zoom in"),n("calcite-action",{text:"Zoom out",icon:"minus",scale:"s",disabled:!i.canZoomOut,onclick:i.zoomOut.bind(i)}),n("calcite-tooltip",{"close-on-click":"","overlay-positioning":"fixed",afterCreate:p.bind(this)},"Zoom out"))),n("calcite-action-bar",{"expand-disabled":"",floating:!0},n("calcite-action-group",null,n("calcite-action",{text:"Default extent",icon:"home",scale:"s",onclick:o.go.bind(o)}),n("calcite-tooltip",{"close-on-click":"","overlay-positioning":"fixed",afterCreate:p.bind(this)},"Default extent"),c?[n("calcite-action",{text:"Zoom to location",icon:"gps-on",scale:"s",disabled:"",afterCreate:this._initializeLocate.bind(this)}),n("calcite-tooltip",{"close-on-click":"","overlay-positioning":"fixed",afterCreate:p.bind(this)},"Zoom to location")]:null,e.constraints.rotationEnabled?[n("calcite-action",{text:"Reset orientation",icon:"compass-needle",scale:"s",afterCreate:this._compassRotation.bind(this),onclick:()=>e.rotation=0}),n("calcite-tooltip",{"close-on-click":"","overlay-positioning":"fixed",afterCreate:p.bind(this)},"Reset orientation")]:null)),a?n("calcite-action-bar",{"expand-disabled":"",floating:!0},n("calcite-action-group",null,n("calcite-action",{text:r,disabled:"",scale:"s",icon:d,afterCreate:this._initializeFullscreen.bind(this)}),n("calcite-tooltip",{"close-on-click":"","overlay-positioning":"fixed",afterCreate:p.bind(this)},r))):null,l?n("calcite-action-bar",{"expand-disabled":"",floating:!0},n("calcite-action-group",null,n("calcite-action",{text:s?"Hide magnifier":"Show magnifier",scale:"s",icon:"magnifying-glass",indicator:!!s,onclick:this._toggleMagnifier.bind(this)}),n("calcite-tooltip",{"close-on-click":"","overlay-positioning":"fixed",afterCreate:p.bind(this)},s?"Hide magnifier":"Show magnifier"))):null))}};i([o()],b.prototype,"_fullscreen",void 0),i([o()],b.prototype,"_locateState",void 0),b=i([c("cov.components.ViewControl2D")],b);export default b;