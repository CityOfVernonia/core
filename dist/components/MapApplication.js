/* His name was Bruce McNair. Copyright 2025 City of Vernonia, Oregon. */
import{__awaiter as t,__decorate as e}from"tslib";import i from"@arcgis/core/config";import o from"@arcgis/core/identity/IdentityManager";import{watch as n}from"@arcgis/core/core/reactiveUtils";import{subclass as l,property as a}from"@arcgis/core/core/accessorSupport/decorators";import s from"@arcgis/core/widgets/Widget";import{tsx as c}from"@arcgis/core/widgets/support/widget";import r from"@arcgis/core/core/Collection";import{subscribe as d}from"pubsub-js";const p="cov--map-application_view";let h=0;export const SHOW_ALERT_TOPIC="map-application-show-alert";let m=class extends s{get container(){return this._container}set container(t){this._container=t}constructor(t){super(t),this._container=document.createElement("calcite-shell"),this.disclaimerOptions={},this.float=!0,this.header=!0,this.headerOptions={},this.position="end",this._actionGroups=new r,this._alerts=new r([c("calcite-alert",null)]),this._components=new r,this._visibleComponent=null,this.container=this._container,document.body.appendChild(this.container)}postInitialize(){return t(this,void 0,void 0,function*(){var t;const{basemapOptions:e,components:n,disclaimerOptions:l,container:a,endComponent:s,float:c,loading:p,position:h,title:m,shellPanel:u,view:g,view:{ui:f},viewControlOptions:b}=this;a.contentBehind=c,p||(this.loading=new((yield import("./Loading")).default)({title:m}));let v=!0;const _=(yield import("./DisclaimerDialog")).default;try{(yield o.checkSignInStatus(i.portalUrl))&&(v=!1)}catch(t){"User is not signed in."!==t.message&&console.log(t),v=!0}v&&!_.isAccepted()&&new _(l),!u&&n&&n.length&&this._addComponents(n),!u&&s&&this._addComponents(new r([s]),!0),f.remove(["attribution","zoom"]),f.add(new((yield import("./Attribution")).default)({view:g}),"start"===h?"bottom-right":"bottom-left"),f.add(new((yield import("./ViewControl2D")).default)(Object.assign({view:g},b)),"start"===h?"top-right":"top-left"),e&&f.add(new((yield import("./Basemap")).default)(Object.assign({view:g},e)),"start"===h?"bottom-left":"bottom-right"),d(SHOW_ALERT_TOPIC,(t,e)=>{this._showAlert(e)}),yield g.when(),null===(t=this.loading)||void 0===t||t.end()})}_addComponents(t,e){const{_actionGroups:i,_components:o}=this;let l=[];t.forEach((a,s)=>{const{component:r,icon:d,groupEnd:p,text:m,type:u}=a;let g;switch(r.addHandles(r.on(SHOW_ALERT_TOPIC,this._showAlert.bind(this))),u){case"calcite-dialog":r.container||(r.container=document.createElement(u),document.body.append(r.container)),r.visible=!0,r.container.open=!1;break;case"calcite-flow":g=c("calcite-flow",{afterCreate:t=>{r.container=t}});break;case"calcite-panel":g=c("calcite-panel",{afterCreate:t=>{r.container=t}})}g&&(o.add(g),this.addHandles(n(()=>this._visibleComponent,t=>{r.visible=t===r.id})));const f=c("calcite-action",{icon:d,text:m,afterCreate:t=>{"calcite-dialog"===u?t.addEventListener("click",()=>{r.container.open=!0}):(t.addEventListener("click",()=>{this._visibleComponent=this._visibleComponent===r.id?null:r.id}),this.addHandles(n(()=>this._visibleComponent,e=>{t.active=e===r.id})))}},c("calcite-tooltip",{"close-on-click":"","overlay-positioning":"fixed",slot:"tooltip"},m));l.push(f),(p||s+1===t.length)&&(i.add(c("calcite-action-group",{key:h++,slot:e?"actions-end":null},l)),l=[])})}_shellPanelActionBarViewPadding(t){const{position:e,view:i}=this,o=()=>{const o=t.getBoundingClientRect().width;i.padding="start"===e?Object.assign(Object.assign({},i.padding),{left:o}):Object.assign(Object.assign({},i.padding),{right:o})};o(),new ResizeObserver(()=>{o()}).observe(t)}_showAlert(t){const{_alerts:e}=this,{duration:i,icon:o,kind:n,label:l,link:a,message:s,title:r,width:d}=t;e.add(c("calcite-alert",{key:h++,icon:o||null,kind:n||"brand",open:!0,label:l,"auto-close":i?"":null,"auto-close-duration":i||null,style:d?`--calcite-alert-width: ${d}px`:null},r?c("div",{slot:"title"},r):null,c("div",{slot:"message"},s),a?c("calcite-link",{href:a.href||null,slot:"link",target:a.href?"_blank":null,onclick:t=>{t.click&&t.addEventListener("click",t.click)}},a.text):null))}render(){const{header:e,headerOptions:i,float:o,position:n,shellPanel:l,title:a,_actionGroups:s,_alerts:r,_components:d,_visibleComponent:h}=this;return c("calcite-shell",null,e?c("div",{afterCreate:e=>t(this,void 0,void 0,function*(){new((yield import("./ApplicationHeader")).default)(Object.assign({container:e,title:a},i))})}):null,c("div",{class:p,afterCreate:this._viewAfterCreate.bind(this)}),l?c("calcite-shell-panel",{afterCreate:this._shellPanelAfterCreate.bind(this)}):null,!l&&d.length?c("calcite-shell-panel",{collapsed:null===h,"display-mode":o?"float-content":"dock",position:n,slot:`panel-${n}`},c("calcite-action-bar",{slot:"action-bar",afterCreate:this._actionBarAfterCreate.bind(this)},s.toArray()),d.toArray()):null,c("div",{slot:"alerts"},r.length?r.toArray():null))}_actionBarAfterCreate(t){const{float:e}=this;e&&this._shellPanelActionBarViewPadding(t)}_shellPanelAfterCreate(t){const{float:e,position:i}=this;t.displayMode=e?"float-content":"dock",t.position=i,t.slot=`panel-${i}`,this.shellPanel&&(this.shellPanel.container=t),setTimeout(()=>{const i=t.querySelector('calcite-action-bar[slot="action-bar"]');i&&e&&this._shellPanelActionBarViewPadding(i)},0)}_viewAfterCreate(t){const{view:e}=this;e.container=t}};e([a({type:r})],m.prototype,"components",void 0),e([a()],m.prototype,"_visibleComponent",void 0),m=e([l("cov.components.MapApplication")],m);export default m;