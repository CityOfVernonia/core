/* His name was Bruce McNair. Copyright 2025 City of Vernonia, Oregon. */
import{__awaiter as t,__decorate as e}from"tslib";import i from"@arcgis/core/config";import o from"@arcgis/core/identity/IdentityManager";import{watch as n}from"@arcgis/core/core/reactiveUtils";import{subclass as a,property as s}from"@arcgis/core/core/accessorSupport/decorators";import l from"@arcgis/core/widgets/Widget";import{tsx as c}from"@arcgis/core/widgets/support/widget";import r from"@arcgis/core/core/Collection";import{subscribe as d}from"pubsub-js";const p="cov--map-application_view";let h=0;export const SHOW_ALERT_TOPIC="map-application-show-alert";let m=class extends l{get container(){return this._container}set container(t){this._container=t}constructor(t){super(t),this._container=document.createElement("calcite-shell"),this.disclaimerOptions={},this.float=!0,this.header=!0,this.headerOptions={},this.position="end",this._actionGroups=new r,this._components=new r,this._visibleComponent=null,this._alerts=new r([c("calcite-alert",null)]),this.container=this._container,document.body.appendChild(this.container)}postInitialize(){return t(this,void 0,void 0,(function*(){const{basemapOptions:t,components:e,disclaimerOptions:n,container:a,endComponent:s,float:l,position:c,title:p,view:h,view:{ui:m},viewControlOptions:u}=this;a.contentBehind=l;const g=new((yield import("./Loading")).default)({title:p});let f=!0;const v=(yield import("./DisclaimerDialog")).default;try{(yield o.checkSignInStatus(i.portalUrl))&&(f=!1)}catch(t){"User is not signed in."!==t.message&&console.log(t),f=!0}f&&!v.isAccepted()&&new v(n),e&&e.length&&this._addComponents(e),s&&this._addComponents(new r([s]),!0),m.remove(["attribution","zoom"]),m.add(new((yield import("./Attribution")).default)({view:h}),"start"===c?"bottom-right":"bottom-left"),m.add(new((yield import("./ViewControl2D")).default)(Object.assign({view:h},u)),"start"===c?"top-right":"top-left"),t&&m.add(new((yield import("./Basemap")).default)(Object.assign({view:h},t)),"start"===c?"bottom-left":"bottom-right"),d(SHOW_ALERT_TOPIC,((t,e)=>{this._showAlert(e)})),yield h.when(),g.end()}))}_addComponents(t,e){const{_actionGroups:i,_components:o}=this;let a=[];t.forEach(((s,l)=>{const{component:r,icon:d,groupEnd:p,text:m,type:u}=s;let g;switch(r.addHandles(r.on(SHOW_ALERT_TOPIC,this._showAlert.bind(this))),u){case"calcite-dialog":r.container||(r.container=document.createElement(u),document.body.append(r.container)),r.visible=!0,r.container.open=!1;break;case"calcite-flow":g=c("calcite-flow",{afterCreate:t=>{r.container=t}});break;case"calcite-panel":g=c("calcite-panel",{afterCreate:t=>{r.container=t}})}g&&(o.add(g),this.addHandles(n((()=>this._visibleComponent),(t=>{r.visible=t===r.id}))));const f=c("calcite-action",{icon:d,text:m,afterCreate:t=>{"calcite-dialog"===u?t.addEventListener("click",(()=>{r.container.open=!0})):(t.addEventListener("click",(()=>{this._visibleComponent=this._visibleComponent===r.id?null:r.id})),this.addHandles(n((()=>this._visibleComponent),(e=>{t.active=e===r.id}))))}},c("calcite-tooltip",{"close-on-click":"","overlay-positioning":"fixed",slot:"tooltip"},m));a.push(f),(p||l+1===t.length)&&(i.add(c("calcite-action-group",{key:h++,slot:e?"actions-end":null},a)),a=[])}))}_showAlert(t){const{_alerts:e}=this,{duration:i,icon:o,kind:n,label:a,link:s,message:l,title:r,width:d}=t;e.add(c("calcite-alert",{key:h++,icon:o||null,kind:n||"brand",open:!0,label:a,"auto-close":i?"":null,"auto-close-duration":i||null,style:d?`--calcite-alert-width: ${d}px`:null},r?c("div",{slot:"title"},r):null,c("div",{slot:"message"},l),s?c("calcite-link",{href:s.href||null,slot:"link",target:s.href?"_blank":null,onclick:t=>{t.click&&t.addEventListener("click",t.click)}},s.text):null))}render(){const{header:e,headerOptions:i,float:o,position:n,title:a,_actionGroups:s,_alerts:l,_components:r,_visibleComponent:d}=this;return c("calcite-shell",null,e?c("div",{afterCreate:e=>t(this,void 0,void 0,(function*(){new((yield import("./ApplicationHeader")).default)(Object.assign({container:e,title:a},i))}))}):null,c("div",{class:p,afterCreate:this._viewAfterCreate.bind(this)}),r.length?c("calcite-shell-panel",{collapsed:null===d,"display-mode":o?"float-content":"dock",position:n,slot:`panel-${n}`},c("calcite-action-bar",{slot:"action-bar",afterCreate:this._actionBarAfterCreate.bind(this)},s.toArray()),r.toArray()):null,c("div",{slot:"alerts"},l.length?l.toArray():null))}_actionBarAfterCreate(t){const{float:e,position:i,view:o}=this;if(!e)return;const n=()=>{const e=t.getBoundingClientRect().width;o.padding="start"===i?Object.assign(Object.assign({},o.padding),{left:e}):Object.assign(Object.assign({},o.padding),{right:e})};n(),new ResizeObserver((()=>{n()})).observe(t)}_viewAfterCreate(t){const{view:e}=this;e.container=t}};e([s({type:r})],m.prototype,"components",void 0),e([s()],m.prototype,"_visibleComponent",void 0),m=e([a("cov.components.MapApplication")],m);export default m;