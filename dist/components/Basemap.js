/* His name was Bruce McNair. Copyright 2025 City of Vernonia, Oregon. */
import{__awaiter as e,__decorate as i}from"tslib";import{property as t,subclass as a}from"@arcgis/core/core/accessorSupport/decorators";import s from"@arcgis/core/widgets/Widget";import{tsx as r}from"@arcgis/core/widgets/support/widget";import{subscribe as o}from"pubsub-js";const l="cov--basemap",n={base:l,image:`${l}_image`};export const IMAGERY_LAYER_TOPIC="basemap-imagery-layer-topic";export const IMAGERY_REFERENCE_LAYER_TOPIC="basemap-imagery-reference-layer-topic";export const ROAD_LAYER_TOPIC="basemap-road-layer-topic";let m=class extends s{get container(){return this._container}set container(e){this._container=e}constructor(e){super(e),this._hillshadeThumbnail="",this._imageryThumbnail=""}postInitialize(){return e(this,void 0,void 0,function*(){const{hillshade:e,imagery:i}=this;e.thumbnailUrl?this._hillshadeThumbnail=e.thumbnailUrl:(yield e.load(),this._hillshadeThumbnail=e.thumbnailUrl||""),i.thumbnailUrl?this._imageryThumbnail=i.thumbnailUrl:(yield i.load(),this._imageryThumbnail=i.thumbnailUrl||"");const t=i.baseLayers.getItemAt(0);t&&(this._default=t),o(IMAGERY_LAYER_TOPIC,(e,i)=>{"default"===i?this.imageryLayer(this._default):this.imageryLayer(i)}),o(IMAGERY_REFERENCE_LAYER_TOPIC,(e,i)=>{this.imageryReferenceVisibility(i)}),o(ROAD_LAYER_TOPIC,(e,i)=>{this.roadLayerVisibility(i)})})}imageryLayer(e){const{imagery:i,imagery:{baseLayers:t},_basemap:a}=this;t.splice(0,1,e),a!==i&&(this._basemap=i)}imageryReferenceVisibility(e){const{imagery:i,imagery:{baseLayers:t},_basemap:a}=this,s=t.getItemAt(t.length-1);s&&(s.visible=e),a!==i&&(this._basemap=i)}roadLayerVisibility(i){return e(this,void 0,void 0,function*(){const{hillshade:e,imagery:t}=this,a=e.baseLayers.getItemAt(1);a.loaded||(yield a.load());const s=t.baseLayers.getItemAt(1);s.loaded||(yield s.load()),a.currentStyleInfo.style.layers.forEach(e=>{const{id:t}=e;t.includes("Road")&&a.setStyleLayerVisibility(t,i?"visible":"none")}),s.currentStyleInfo.style.layers.forEach(e=>{const{id:t}=e;t.includes("Road")&&s.setStyleLayerVisibility(t,i?"visible":"none")})})}_info(){const{hillshade:e,_basemap:i,_hillshadeThumbnail:t,_imageryThumbnail:a}=this,s=i===e;return{tooltip:s?"Imagery":"Map",url:s?a:t}}_toggle(){const{hillshade:e,imagery:i,_basemap:t}=this;this._basemap=t===e?i:e}_tooltip(e){e.referenceElement=this.container}render(){const{tooltip:e,url:i}=this._info();return r("div",{class:n.base},r("div",{class:n.image,style:`background-image: url(${i})`,onclick:this._toggle.bind(this)}),r("calcite-tooltip",{"close-on-click":"","overlay-positioning":"fixed",afterCreate:this._tooltip.bind(this)},e))}};i([t({aliasOf:"view.map.basemap"})],m.prototype,"_basemap",void 0),i([t()],m.prototype,"_hillshadeThumbnail",void 0),i([t()],m.prototype,"_imageryThumbnail",void 0),m=i([a("cov.components.Basemap")],m);export default m;