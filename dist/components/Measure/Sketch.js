/* His name was Bruce McNair. Copyright 2025 City of Vernonia, Oregon. */
import{__awaiter as e,__decorate as t}from"tslib";import{whenOnce as i}from"@arcgis/core/core/reactiveUtils";import{subclass as o}from"@arcgis/core/core/accessorSupport/decorators";import r from"@arcgis/core/widgets/Sketch/SketchViewModel";import s from"@arcgis/core/views/interactive/snapping/SnappingOptions";import a from"@arcgis/core/views/interactive/snapping/FeatureSnappingLayerSource";import l from"@arcgis/core/layers/GroupLayer";import n from"@arcgis/core/layers/GraphicsLayer";import c from"@arcgis/core/Graphic";import p from"@arcgis/core/geometry/Point";import y from"@arcgis/core/symbols/CIMSymbol";import m from"@arcgis/core/symbols/SimpleMarkerSymbol";import d from"@arcgis/core/symbols/TextSymbol";import{APPLICATION_MEASURE_LAYER as h}from"../../support/layerUtils";const S={PRIMARY:[237,81,81],SECONDARY:[255,255,255]},b="sketch-custom-handles",f=[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[4.75,4.75],lineDashEnding:"HalfPattern",offsetAlongLine:0}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:2.25,color:[...S.SECONDARY,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:2.25,color:[...S.PRIMARY,255]}],g=new m({style:"circle",size:6,color:S.SECONDARY,outline:{width:1,color:S.PRIMARY}}),u=new y({data:{type:"CIMSymbolReference",symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[...S.PRIMARY,32]},...f]}}}),w=new y({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:f}}}),M=new s({enabled:!0,featureEnabled:!0,selfEnabled:!0}),R=new d({color:S.PRIMARY,haloColor:S.SECONDARY,haloSize:2,horizontalAlignment:"center",verticalAlignment:"middle",font:{size:10}});let v=class extends r{constructor(t){super(t),this.labels=new n,this.layer=new n,this.layers=new l({listMode:"hide"}),this._textSymbol=R,this.updateOnGraphicClick=!1,this._initialized=!1,this.activeFillSymbol=u,this.activeLineSymbol=w,this.activeVertexSymbol=g,this.pointSymbol=g,this.polygonSymbol=u,this.polylineSymbol=w,this.snappingOptions=M,this.vertexSymbol=g,this.textSymbol=R,this.layers.addMany([this.layer,this.labels]),i(()=>this.view).then(t=>e(this,void 0,void 0,function*(){if(!t||!t.map)return;yield t.when(),h?h.add(this.layers):t.map.add(this.layers);const e=t.map.layers;e.forEach(this._addSnappingLayer.bind(this)),this.addHandles(e.on("after-add",e=>{this._addSnappingLayer(e.item)}),b)})),this.addHandles(this.on("create",this._addVertices.bind(this)),b)}get textSymbol(){return this._textSymbol}set textSymbol(e){this._textSymbol=e}clearGraphics(e){const{labels:t,layer:i}=this;"all"!==e&&"labels"!==e||t.removeAll(),"all"!==e&&"geometry"!==e||i.removeAll()}_addSnappingLayer(e){const{snappingOptions:{featureSources:t}}=this,{listMode:i,title:o,type:r}=e;if("group"===r)return void e.layers.forEach(this._addSnappingLayer.bind(this));if(!0===e.internal)return;if("hide"===i||!o)return;if("graphics"!==r&&"csv"!==r&&"feature"!==r&&"geojson"!==r)return;const s=e;t.add(new a({layer:s}))}_addVertices(e){const{layer:t,pointSymbol:i,view:o}=this,{graphic:{geometry:r},state:s}=e;if(!o||!r||"complete"!==s||"polygon"!==r.type&&"polyline"!==r.type)return;const a="polyline"===r.type?r.paths[0]:r.rings[0];t.addMany(a.map(e=>{const[t,r]=e;return new c({geometry:new p({x:t,y:r,spatialReference:o.spatialReference}),symbol:i})}))}};v=t([o("cov.components.Measure.Sketch")],v);export default v;