/* His name was Bruce McNair. Copyright 2024 City of Vernonia, Oregon. */
import{__awaiter as e,__decorate as i}from"tslib";import{subclass as t,property as n}from"@arcgis/core/core/accessorSupport/decorators";import o from"@arcgis/core/widgets/Widget";import{tsx as l}from"@arcgis/core/widgets/support/widget";import s from"@arcgis/core/core/Collection";const r="cov-panels--planning-files_content";let c=0,a=class extends o{constructor(e){super(e),this._definitionExpression="",this._filtered=!1,this._filterCount=0,this._filterType="",this._planningTypeOptions=new s([l("calcite-option",{selected:"",value:"none"},"All (no filter)")])}postInitialize(){return e(this,void 0,void 0,(function*(){const{planningFilesLayer:e,_planningTypeOptions:i}=this;yield e.when();const t=e.fields.find((e=>"planning_type"===e.name));(null==t?void 0:t.domain).codedValues.sort(((e,i)=>e.name<i.name?-1:1)).forEach((e=>{const{code:t,name:n}=e;i.add(l("calcite-option",{key:c++,value:t},n))})),this.scheduleRender()}))}_getFilterCount(){return e(this,void 0,void 0,(function*(){const{planningFilesLayer:e,_definitionExpression:i}=this;this._filterCount=yield e.queryFeatureCount({where:i}),this._filtered=!0}))}_zoomToFiltered(){return e(this,void 0,void 0,(function*(){const{planningFilesLayer:e,view:i,_definitionExpression:t}=this,{count:n,extent:o}=yield e.queryExtent({where:t});n&&i.goTo(o)}))}render(){const{_filtered:e,_filterCount:i,_filterType:t,_planningTypeOptions:n}=this;return l("calcite-panel",{heading:"Planning Files"},l("div",{class:r},l("calcite-label",{layout:"inline"},l("calcite-switch",{afterCreate:this._layerSwitchAfterCreate.bind(this)}),"Planning Files"),l("calcite-label",{style:e?null:"--calcite-label-margin-bottom: 0;"},"Filter planning type",l("calcite-select",{afterCreate:this._filterSelectAfterCreate.bind(this)},n.toArray())),l("calcite-notice",{icon:"filter",open:e,scale:"s"},l("div",{slot:"title"},t),l("div",{slot:"message"},i," planning file",1===i?"":"s"),l("calcite-link",{slot:"link",onclick:this._zoomToFiltered.bind(this)},"Zoom to"))))}_filterSelectAfterCreate(e){const{planningFilesLayer:i}=this;e.addEventListener("calciteSelectChange",(()=>{this._filtered=!1;const t=e.selectedOption.value;"none"===t?this._definitionExpression=this._filterType=i.definitionExpression="":(this._definitionExpression=i.definitionExpression=`planning_type = '${t}'`,this._filterType=t,this._getFilterCount())}))}_layerSwitchAfterCreate(e){const{planningFilesLayer:i}=this;i.visible&&(e.checked=!0),e.addEventListener("calciteSwitchChange",(()=>{i.visible=e.checked})),this.addHandles(i.watch("visible",(i=>{e.checked=i})))}};i([n()],a.prototype,"_definitionExpression",void 0),i([n()],a.prototype,"_filtered",void 0),i([n()],a.prototype,"_filterCount",void 0),i([n()],a.prototype,"_filterType",void 0),a=i([t("cov.components.panels.PlanningFiles")],a);export default a;