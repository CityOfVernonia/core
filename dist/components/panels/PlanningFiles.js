/* His name was Bruce McNair. Copyright 2024 City of Vernonia, Oregon. */
import{__awaiter as e,__decorate as t}from"tslib";import{subclass as i,property as l}from"@arcgis/core/core/accessorSupport/decorators";import n from"@arcgis/core/widgets/Widget";import{tsx as a}from"@arcgis/core/widgets/support/widget";import r from"@arcgis/core/core/Collection";const s="cov-panels--planning-files_content";let c=0,o=class extends n{constructor(e){super(e),this._filtered=!1,this._planningStatusOptions=new r([a("calcite-option",{selected:"",value:""},"No status filter")]),this._planningTypeOptions=new r([a("calcite-option",{selected:"",value:""},"No type filter")])}postInitialize(){return e(this,void 0,void 0,(function*(){const{layer:e,_planningStatusOptions:t,_planningTypeOptions:i}=this;yield e.when();const l=e.fields.find((e=>"status"===e.name));(null==l?void 0:l.domain).codedValues.sort(((e,t)=>e.name<t.name?-1:1)).forEach((e=>{const{code:i,name:l}=e;t.add(a("calcite-option",{key:c++,value:i},l))}));const n=e.fields.find((e=>"planning_type"===e.name));(null==n?void 0:n.domain).codedValues.sort(((e,t)=>e.name<t.name?-1:1)).forEach((e=>{const{code:t,name:l}=e;i.add(a("calcite-option",{key:c++,value:t},l))})),this.scheduleRender()}))}_clearFilters(){const{container:e,layer:t}=this;e.querySelector('[data-filter="status"]').value="",e.querySelector('[data-filter="type"]').value="",this._filtered=!1,t.definitionExpression=""}_filter(){const{container:e,layer:t}=this,i=e.querySelector('[data-filter="status"]').selectedOption.value,l=e.querySelector('[data-filter="type"]').selectedOption.value;let n="";this._filtered=i||l,i&&(n+=`status = '${i}'`),i&&l&&(n+=" AND "),l&&(n+=`planning_type = '${l}'`),t.definitionExpression=n}render(){const{_filtered:e,_planningStatusOptions:t,_planningTypeOptions:i}=this;return a("calcite-panel",{heading:"Planning Files"},a("div",{class:s},a("calcite-label",{layout:"inline"},a("calcite-switch",{afterCreate:this._layerSwitchAfterCreate.bind(this)}),"Planning Files"),a("calcite-label",null,"Filter planning status",a("calcite-select",{"data-filter":"status",afterCreate:this._filterSelectAfterCreate.bind(this)},t.toArray())),a("calcite-label",{style:"--calcite-label-margin-bottom: 0;"},"Filter planning type",a("calcite-select",{"data-filter":"type",afterCreate:this._filterSelectAfterCreate.bind(this)},i.toArray()))),a("calcite-button",{appearance:"transparent",hidden:!e,slot:e?"footer":null,width:"full",onclick:this._clearFilters.bind(this)},"Clear Filters"))}_filterSelectAfterCreate(e){e.addEventListener("calciteSelectChange",this._filter.bind(this))}_layerSwitchAfterCreate(e){const{layer:t}=this;t.visible&&(e.checked=!0),e.addEventListener("calciteSwitchChange",(()=>{t.visible=e.checked})),this.addHandles(t.watch("visible",(t=>{e.checked=t})))}};t([l()],o.prototype,"_filtered",void 0),o=t([i("cov.components.panels.PlanningFiles")],o);export default o;