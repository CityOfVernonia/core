/* His name was Bruce McNair. Copyright 2025 City of Vernonia, Oregon. */
import{__awaiter as e,__decorate as t}from"tslib";import{property as o,subclass as r}from"@arcgis/core/core/accessorSupport/decorators";import s from"@arcgis/core/widgets/Widget";import{tsx as i}from"@arcgis/core/widgets/support/widget";import n from"@arcgis/core/core/Collection";import c from"./../support/logo";import{referenceElement as a}from"./support";const l="cov--application-header",u="cov--header-user",d={header:l,headerTitleContainer:`${l}_title-container`,headerTitleLogo:`${l}_title-logo`,headerTitleText:`${l}_title-text`,headerSearchContainer:`${l}_search-container`,headerControlsContainer:`${l}_controls-container`,search:"cov--header-search",user:u,userPopover:`${u}_popover`};let h=0,p=class extends s{constructor(e){super(e)}render(){const{title:e}=this;return i("div",{class:d.header,slot:"header"},i("div",{class:d.headerTitleContainer},i("img",{class:d.headerTitleLogo,src:c}),i("div",{class:d.headerTitleText},e)),i("div",{class:d.headerSearchContainer},i("div",{afterCreate:e=>{const{search:t}=this;t&&new g({container:e,search:t})}})),i("div",{class:d.headerControlsContainer},i("div",{afterCreate:e=>{const{oAuth:t}=this;t&&new _({container:e,oAuth:t})}})))}};p=t([r("cov.components.ApplicationHeader")],p);export default p;let g=class extends s{constructor(e){super(e),this._searchAbortController=null,this._selectingResult=!1,this._sourcesDropdownItems=new n,this._suggestions=new n;const{search:t}=e;t.includeDefaultSources=!1,t.searchAllEnabled=!1}postInitialize(){return e(this,void 0,void 0,(function*(){const{_sources:e}=this;this._addSources(e),this.addHandles(e.on("change",this._addSources.bind(this,e)))}))}_addSources(e){const{search:t,_activeSource:o,_sourcesDropdownItems:r}=this;r.removeAll(),e.forEach(((e,s)=>{const{name:n}=e;r.add(i("calcite-dropdown-item",{key:h++,selected:o===e,afterCreate:e=>{e.addEventListener("calciteDropdownItemSelect",(()=>{t.activeSourceIndex=s}))}},n))}))}_search(t){return e(this,void 0,void 0,(function*(){const{search:e,_suggestions:o}=this;this._searchAbort(),o.removeAll();const r=new AbortController,{signal:s}=r;this._searchAbortController=r;try{const i=yield e.suggest(t,null,{signal:s});if(this._searchAbortController!==r)return;if(this._searchAbortController=null,!i||!i.numResults)return;o.addMany(i.results[0].results||[])}catch(e){this._searchAbortController=null,"Aborted"!==e.message&&console.log(e)}}))}_searchAbort(){const{_searchAbortController:e}=this;e&&(e.abort(),this._searchAbortController=null)}_selectResult(t){return e(this,void 0,void 0,(function*(){const{search:e,_autocomplete:o,_selectingResult:r,_suggestions:s,_view:i}=this;if(!r){this._selectingResult=!0,o.inputValue=t.text,s.removeAll();try{const o=(yield e.search(t)).results[0];if(!o.results)return;const r=o.results[0].feature;i&&(i.goTo(r.geometry),r.geometry&&"point"===r.geometry.type&&(i.scale=1200),i.openPopup({features:[r]})),this._selectingResult=!1}catch(e){this._selectingResult=!1,console.log(e)}}}))}render(){const{_activeSource:e,_sources:t,_sourcesDropdownItems:o}=this;return e?i("div",{class:d.search},t&&t.length>1?i("calcite-dropdown",{"overlay-positioning":"fixed",afterCreate:this._dropdownAfterCreate.bind(this)},i("calcite-button",{"icon-start":"chevron-down",slot:"trigger"}),i("calcite-dropdown-group",null,o.toArray())):null,i("form",{afterCreate:this._formAfterCreate.bind(this)},i("calcite-autocomplete",{autocomplete:!1,icon:!1,placeholder:e.placeholder,afterCreate:this._autocompleteAfterCreate.bind(this)},this._renderSuggestions())),i("calcite-button",{"icon-start":"search",afterCreate:this._buttonAfterCreate.bind(this)})):i("div",null)}_renderSuggestions(){const{_suggestions:e}=this;return 0===e.length?[]:e.toArray().map((e=>i("calcite-autocomplete-item",{key:h++,heading:e.text,"icon-start":"search",value:e})))}_autocompleteAfterCreate(e){this._autocomplete=e,e.addEventListener("calciteAutocompleteTextInput",(()=>{const{_selectingResult:t,_suggestions:o}=this;if(t)return;const{inputValue:r}=e;r?this._search(r):o.removeAll()})),e.addEventListener("calciteAutocompleteChange",(()=>{const t=e.value;t&&this._selectResult(t)}))}_buttonAfterCreate(e){e.addEventListener("click",(()=>{const{_autocomplete:e,_suggestions:t}=this,o=t.getItemAt(0);o?this._selectResult(o):e.inputValue?e.selectText():e.setFocus()}))}_dropdownAfterCreate(e){e.addEventListener("calciteDropdownSelect",(()=>{const{_autocomplete:e,_suggestions:t}=this;t.removeAll(),e.inputValue="",e.setFocus()}))}_formAfterCreate(e){e.addEventListener("submit",(e=>{e.preventDefault();const{_suggestions:t}=this,o=t.getItemAt(0);o&&this._selectResult(o)}))}};t([o({aliasOf:"search.activeSource"})],g.prototype,"_activeSource",void 0),t([o({aliasOf:"search.sources"})],g.prototype,"_sources",void 0),t([o()],g.prototype,"_sourcesDropdownItems",void 0),t([o()],g.prototype,"_suggestions",void 0),t([o({aliasOf:"search.view"})],g.prototype,"_view",void 0),g=t([r("HeaderSearch")],g);let _=class extends s{constructor(e){super(e)}render(){const{oAuth:e,oAuth:{signedIn:t,fullName:o,username:r,thumbnailUrl:s}}=this;return t?i("div",{class:d.user},i("calcite-avatar",{"full-name":o,thumbnail:s,role:"button"}),i("calcite-popover",{"auto-close":"",label:"Sign out","overlay-positioning":"fixed",afterCreate:a},i("div",{class:d.userPopover},i("div",null,o),i("span",null,r),i("calcite-button",{scale:"small",width:"full",onclick:e.signOut.bind(e)},"Sign out")))):i("div",{class:d.user},i("calcite-icon",{icon:"sign-in",role:"button",onclick:e.signIn.bind(e)}),i("calcite-tooltip",{label:"Sign in","overlay-positioning":"fixed",afterCreate:a},"Sign in"))}};_=t([r("HeaderUser")],_);