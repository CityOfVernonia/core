/* His name was Bruce McNair. Copyright 2024 City of Vernonia, Oregon. */
import{__awaiter as t,__decorate as e}from"tslib";import{subclass as o,property as n}from"@arcgis/core/core/accessorSupport/decorators";import l from"@arcgis/core/widgets/Widget";import{tsx as r}from"@arcgis/core/widgets/support/widget";import i from"@arcgis/core/PopupTemplate";import{propertyInfoUrl as a,taxMapUrl as s}from"./../support/assessorUtils";import{geodesicBuffer as c}from"@arcgis/core/geometry/geometryEngine";let d=0,u=class extends i{constructor(t){super(t),this.outFields=["*"],this.title="{TAXLOT_ID}",this.content=t=>{const{zoning:e,floodZones:o}=this,n=document.createElement("table");return new p({graphic:t.graphic,container:n,zoning:e,floodZones:o}),n}}};u=e([o("cov.popups.VernoniaMapTaxLotPopup")],u);export default u;let p=class extends l{constructor(t){super(t),this._zoning=r("tr",null,r("th",null,"Zoning"),r("td",{style:"text-align:center;padding:0;vertical-align:middle;"},r("calcite-button",{style:"transform:scale(0.8);",appearance:"transparent",disabled:"",loading:"",scale:"s"}))),this._floodZones=r("tr",null,r("th",null,"Flood zones"),r("td",{style:"text-align:center;padding:0;vertical-align:middle;"},r("calcite-button",{style:"transform:scale(0.8);",appearance:"transparent",disabled:"",loading:"",scale:"s"})))}postInitialize(){const{graphic:{geometry:t,attributes:{VERNONIA:e}}}=this;if(!e)return;const o=c(t,-1,"feet");this._zoningInfo(o),this._floodZoneInfo(o)}_zoningInfo(e){return t(this,void 0,void 0,(function*(){const{zoning:t}=this,o=yield t.queryFeatures({geometry:e,outFields:["localZCode","localZDesc"],returnGeometry:!1}),n=[];o.features.forEach((t=>{const{localZCode:e,localZDesc:o}=t.attributes,l=`${e} - ${o}`;-1===n.indexOf(l)&&n.push(l)})),this._zoning=r("tr",null,r("th",null,"Zoning"),r("td",null,n.map((t=>r("div",{key:d++},t)))))}))}_floodZoneInfo(e){return t(this,void 0,void 0,(function*(){const{floodZones:t}=this,o=yield t.queryFeatures({geometry:e,outFields:["flood_zone"],returnGeometry:!1}),n=[];o.features.forEach((t=>{const{flood_zone:e}=t.attributes;-1===n.indexOf(e)&&n.push(e)})),this._floodZones=r("tr",null,r("th",null,r("div",{style:"display:flex;flex-direction:row;"},r("span",{style:"margin-right:0.25rem;"},"Flood zones"),r("calcite-icon",{icon:"information",scale:"s",style:"transform:scale(0.875);color:var(--calcite-ui-brand);"}),r("calcite-popover",{"auto-close":"",closable:"","overlay-positioning":"fixed",scale:"s",afterCreate:t=>{t.referenceElement=t.previousElementSibling}},r("div",{style:"max-width:120px;padding:0.25rem;"},"Some portion of the tax lot is affected by the indicated flood zones. Turn on flood hazard layer to view flood zones.")))),r("td",null,n.length?n.map((t=>r("div",{key:d++},t))):"None"))}))}render(){const{_zoning:t,_floodZones:e}=this,{TAXLOT_ID:o,ACCOUNT_IDS:n,TAXMAP:l,ADDRESS:i,OWNER:c,ACRES:d,SQ_FEET:u,VERNONIA:p}=this.graphic.attributes,f=i?r("tr",null,r("th",null,"Address"),r("td",null,i)):null,g=n.split(","),h=1===g.length?r("calcite-link",{href:`${a(g[0])}`,target:"_blank"},g[0]):g.map(((t,e)=>r("span",null,r("calcite-link",{href:`${a(t)}`,target:"_blank"},t),e<g.length-1?r("span",null,"  "):"")));return r("table",{class:"esri-widget__table"},r("tr",null,r("th",null,"Tax lot"),r("td",null,r("calcite-link",{href:`https://vernonia-tax-lot.netlify.app/${o}/`,target:"_blank"},o))),r("tr",null,r("th",null,"Tax map"),r("td",null,r("calcite-link",{href:`${s(l)}`,target:"_blank"},l))),r("tr",null,r("th",null,"Owner"),r("td",null,c)),f,r("tr",null,r("th",null,"Area"),r("td",null,d," acres  ",u.toLocaleString()," sq ft")),r("tr",null,r("th",null,"Tax account",g.length>1?"s":""),r("td",null,h)),p?t:null,p?e:null)}};e([n()],p.prototype,"_zoning",void 0),e([n()],p.prototype,"_floodZones",void 0),p=e([o("VernoniaMapTaxLotPopupContent")],p);