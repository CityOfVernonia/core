/* His name was Bruce McNair. Copyright 2024 City of Vernonia, Oregon. */
import{__awaiter as t,__decorate as e}from"tslib";import{subclass as o,property as n}from"@arcgis/core/core/accessorSupport/decorators";import l from"@arcgis/core/widgets/Widget";import{tsx as r}from"@arcgis/core/widgets/support/widget";import i from"@arcgis/core/PopupTemplate";import{propertyInfoUrl as s,taxMapUrl as a}from"./../support/assessorUtils";import{geodesicBuffer as c}from"@arcgis/core/geometry/geometryEngine";let u=0,d=class extends i{constructor(t){super(t),this.outFields=["*"],this.title="{TAXLOT_ID}",this.content=t=>{const{zoning:e,floodZones:o}=this,n=document.createElement("table");return new p({graphic:t.graphic,container:n,zoning:e,floodZones:o}),n}}};d=e([o("cov.popups.VernoniaMapTaxLotPopup")],d);export default d;let p=class extends l{constructor(t){super(t),this._zoning=r("tr",null,r("th",null,"Zoning"),r("td",{style:"text-align:center;padding:0;vertical-align:middle;"},r("calcite-button",{style:"transform:scale(0.8);",appearance:"transparent",disabled:"",loading:"",scale:"s"}))),this._floodZones=r("tr",null,r("th",null,"Flood zones"),r("td",{style:"text-align:center;padding:0;vertical-align:middle;"},r("calcite-button",{style:"transform:scale(0.8);",appearance:"transparent",disabled:"",loading:"",scale:"s"})))}postInitialize(){const{graphic:{geometry:t,attributes:{VERNONIA:e}}}=this;if(!e)return;const o=c(t,-1,"feet");this._zoningInfo(o),this._floodZoneInfo(o)}_zoningInfo(e){return t(this,void 0,void 0,(function*(){const{zoning:t}=this,o=yield t.queryFeatures({geometry:e,outFields:["localZCode","localZDesc"],returnGeometry:!1}),n=[];o.features.forEach((t=>{const{localZCode:e,localZDesc:o}=t.attributes,l=`${e} - ${o}`;-1===n.indexOf(l)&&n.push(l)})),this._zoning=r("tr",null,r("th",null,"Zoning"),r("td",null,n.map((t=>r("div",{key:u++},t)))))}))}_floodZoneInfo(e){return t(this,void 0,void 0,(function*(){const{floodZones:t}=this,o=yield t.queryFeatures({geometry:e,outFields:["flood_zone"],returnGeometry:!1}),n=[];o.features.forEach((t=>{const{flood_zone:e}=t.attributes;-1===n.indexOf(e)&&n.push(e)})),this._floodZones=r("tr",null,r("th",null,"Flood zones"),r("td",null,n.length?n.map((t=>r("div",{key:u++},t))):"None"))}))}render(){const{_zoning:t,_floodZones:e}=this,{TAXLOT_ID:o,ACCOUNT_IDS:n,TAXMAP:l,ADDRESS:i,OWNER:c,ACRES:u,SQ_FEET:d,VERNONIA:p}=this.graphic.attributes,g=i?r("tr",null,r("th",null,"Address"),r("td",null,i)):null,f=n.split(",").map((t=>r("span",null,r("calcite-link",{href:`${s(t)}`,target:"_blank"},t)," ")));return r("table",{class:"esri-widget__table"},r("tr",null,r("th",null,"Tax lot"),r("td",null,r("calcite-link",{href:`https://vernonia-tax-lot.netlify.app/${o}/`,target:"_blank"},o))),r("tr",null,r("th",null,"Tax map"),r("td",null,r("calcite-link",{href:`${a(l)}`,target:"_blank"},l))),r("tr",null,r("th",null,"Owner"),r("td",null,c)),g,r("tr",null,r("th",null,"Area"),r("td",null,u," acres  ",d.toLocaleString()," sq ft")),r("tr",null,r("th",null,"Tax account(s)"),r("td",null,f)),p?t:null,p?e:null)}};e([n()],p.prototype,"_zoning",void 0),e([n()],p.prototype,"_floodZones",void 0),p=e([o("VernoniaMapTaxLotPopupContent")],p);