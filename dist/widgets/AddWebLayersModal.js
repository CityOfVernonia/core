/* His name was Bruce McNair. Copyright 2023 City of Vernonia, Oregon. */
import{__awaiter as e,__decorate as t}from"tslib";import{subclass as l}from"@arcgis/core/core/accessorSupport/decorators";import a from"@arcgis/core/widgets/Widget";import{tsx as i}from"@arcgis/core/widgets/support/widget";import o from"@arcgis/core/layers/Layer";let c=class extends a{constructor(e){super(e)}_add(t){return e(this,void 0,void 0,(function*(){t.preventDefault();const{container:l,view:a,view:{map:i}}=this,c=new RegExp(/https:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/),r=t.target,s=r.querySelector("calcite-select"),d=s.selectedOption.value,n=r.querySelector("calcite-input"),u=n.value,p=r.querySelector("calcite-input-message"),b=l.querySelector('calcite-button[type="submit"]'),m=t=>e(this,void 0,void 0,(function*(){i.add(t),l.open=!1,yield t.when(),a.goTo(t.fullExtent),s.disabled=!1,n.disabled=!1,b.disabled=!1,n.value="",n.status="valid",p.hidden=!0})),h=e=>{s.disabled=!1,n.disabled=!1,b.disabled=!1,n.status="invalid",n.setFocus(),p.innerHTML=e,p.hidden=!1};if(u)if(u.match(c))switch(s.disabled=!0,n.disabled=!0,b.disabled=!0,d){case"arcgis":o.fromArcGISServerUrl({url:u}).then((e=>{m(e),"feature"===e.type&&(e.popupEnabled=!0),"map-image"===e.type&&e.sublayers.forEach((e=>{e.popupEnabled=!0}))})).catch((e=>{console.log(e),h("Invalid service URL")}));break;case"geojson":{const e=new((yield import("@arcgis/core/layers/GeoJSONLayer")).default)({url:u});e.load().then((()=>{m(e),e.popupEnabled=!0})).catch((e=>{console.log(e),h("Invalid GeoJSON URL")}));break}case"kml":{const e=new((yield import("@arcgis/core/layers/KMLLayer")).default)({url:u});e.load().then((()=>{m(e)})).catch((e=>{console.log(e),h("Invalid KML URL")}));break}}else h("Invalid URL");else h("URL required")}))}render(){const{id:e}=this,t=`add_web_layers_${e}`;return i("calcite-modal",{width:"s"},i("div",{slot:"header"},"Add web layers"),i("div",{slot:"content"},i("form",{id:t,onsubmit:this._add.bind(this)},i("calcite-label",null,"Type",i("calcite-select",null,i("calcite-option",{label:"ArcGIS web service",value:"arcgis"}),i("calcite-option",{label:"GeoJSON",value:"geojson"}),i("calcite-option",{label:"KML",value:"kml"}))),i("calcite-label",null,"URL",i("calcite-input",{type:"text",placeholder:"https://<web service url>"}),i("calcite-input-message",{hidden:!0,icon:"",status:"invalid"})))),i("calcite-button",{form:t,slot:"primary",type:"submit",width:"full"},"Add Layer"),i("calcite-button",{appearance:"outline",slot:"secondary",width:"full",onclick:()=>{this.container.open=!1}},"Close"))}};c=t([l("cov.widgets.AddWebLayersModal")],c);export default c;