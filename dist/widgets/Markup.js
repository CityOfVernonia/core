/* His name was Bruce McNair. Copyright 2023 City of Vernonia, Oregon. */
import{__awaiter as e,__decorate as t}from"tslib";import{subclass as i,property as o}from"@arcgis/core/core/accessorSupport/decorators";import a from"@arcgis/core/widgets/Widget";import{tsx as n}from"@arcgis/core/widgets/support/widget";import l from"@arcgis/core/core/Collection";import s from"@arcgis/core/widgets/Sketch/SketchViewModel";import c from"@arcgis/core/views/interactive/snapping/FeatureSnappingLayerSource";import r from"@arcgis/core/layers/GroupLayer";import d from"@arcgis/core/layers/GraphicsLayer";import h from"@arcgis/core/Graphic";import p from"@arcgis/core/Color";import{CIMSymbol as u,SimpleFillSymbol as f,SimpleLineSymbol as _,SimpleMarkerSymbol as m,TextSymbol as y}from"@arcgis/core/symbols";import b from"./Markup/SymbolEditor";import{queryFeatureGeometry as v,numberOfVertices as g,polylineVertices as w,polygonVertices as S,buffer as k,offset as x}from"./Markup/geometry";const G="cov-markup--content",C="cov-markup--row-heading",L="cov-markup--button-row",D="cov-markup--offset-button",O="cov-markup--selection-notice",E="cov-markup--top-margin",M="cov-markup--tabs";let A=0,V="",R=0;const H={white:[255,255,255],black:[0,0,0],grey:[128,128,128],red:[237,81,81],blue:[20,158,206],green:[167,198,54],purple:[158,85,156],orange:[252,146,31],yellow:[255,222,62]},F="selected-highlights";let U=class extends a{constructor(e){super(e),this.lengthUnit="feet",this.lengthUnits={meters:"Meters",feet:"Feet",kilometers:"Kilometers",miles:"Miles"},this.bufferDistance=250,this.offsetDistance=30,this.offsetDirection="both",this._sketch=new s({layer:new d,snappingOptions:{enabled:!0,featureEnabled:!0,selfEnabled:!0},updateOnGraphicClick:!1}),this.pointSymbol=new m({style:"circle",size:8,color:H.yellow,outline:{width:1,color:H.red}}),this.polylineSymbol=new _({color:H.red,width:2}),this.polygonSymbol=new f({color:[...H.yellow,.125],outline:{color:H.red,width:2}}),this.textSymbol=new y({text:"New text",color:H.red,haloColor:H.white,haloSize:1,horizontalAlignment:"center",verticalAlignment:"middle",font:{size:12}}),this._activeLineSymbol=new u({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[4.75,4.75],lineDashEnding:"HalfPattern",offsetAlongLine:0}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:2,color:[...H.white,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:2,color:[...H.red,255]}]}}}),this._activeVertexSymbol=new m({style:"circle",size:6,color:H.yellow,outline:{color:H.red,width:1}}),this._vertexSymbol=new m({style:"circle",size:6,color:H.white,outline:{color:H.red,width:1}}),this._activeFillSymbol=new f({color:[...H.yellow,.125],outline:{color:H.red,width:2}}),this.point=new d({title:"point"}),this.polyline=new d({title:"polyline"}),this.polygon=new d({title:"polygon"}),this.text=new d({title:"text"}),this.layers=new r({listMode:"hide"}),this._drawState="ready",this._selectState=!1,this._selectHandle=null,this._selectedGraphic=null,this._selectedGraphicsItems=new l,this._highlightedGraphic=null,this._selectedPopupFeature=null,this._graphicsCount=0,this._canUndo=!1,this._canRedo=!1,this._viewState="markup"}postInitialize(){return e(this,void 0,void 0,(function*(){const{view:t,view:{map:i},_sketch:o,pointSymbol:a,point:n,polyline:l,polygon:s,text:c,layers:r}=this;this._ttr(),o.view=t,r.addMany([s,l,n,c,o.layer]),i.add(r),[s,l,n,c].forEach((e=>{this.addHandles(e.watch("graphics.length",this._countGraphics.bind(this)))}));const d=a.clone();this.addHandles(this.watch("_drawState",(e=>{this.pointSymbol="text"===e?this.textSymbol.clone():d.clone()}))),this.addHandles(o.on("create",this._createEvent.bind(this))),this.addHandles(o.on("update",this._updateEvent.bind(this))),this.addHandles([o.on("create",this._undoRedo.bind(this)),o.on("update",this._undoRedo.bind(this)),o.on("redo",this._undoRedo.bind(this)),o.on("undo",this._undoRedo.bind(this))]),this.addHandles(this.watch(["view.popup.visible","view.popup.selectedFeature"],(()=>{const{popup:{visible:e,selectedFeature:i}}=t;this._selectedPopupFeature=e&&i?i:null,this._selectedPopupFeature||(this._viewState="markup")}))),this._pointView=yield t.whenLayerView(n),this._polylineView=yield t.whenLayerView(l),this._polygonView=yield t.whenLayerView(s),this._textView=yield t.whenLayerView(c);const h=yield t.whenLayerView(o.layer);[this._pointView,this._polylineView,this._polygonView,this._textView,h].forEach((t=>e(this,void 0,void 0,(function*(){yield t.when(),t.highlightOptions={color:new p("yellow"),haloOpacity:.75,fillOpacity:.1}})))),yield t.when(),i.layers.forEach(this._addSnappingLayer.bind(this)),this.addHandles(i.layers.on("after-add",(e=>{this._addSnappingLayer(e.item)}))),this.addHandles(this.watch("view.map.layers.length",(()=>{i.layers.reorder(r,i.layers.length-1)})))}))}onHide(){this._reset(),this._viewState="markup",this._selectedGraphicsItems=new l}_addSnappingLayer(e){const{_sketch:{snappingOptions:t}}=this;"group"!==e.type?"hide"!==e.listMode&&void 0!==e.title&&null!==e.title&&!0!==e.internal&&t.featureSources.add(new c({layer:e})):e.layers.forEach((e=>{this._addSnappingLayer(e)}))}_reset(){const{view:{popup:e},_sketch:t}=this;e.close(),e.clear&&"function"==typeof e.clear&&e.clear(),t.cancel(),this._drawState="ready",this._selectReset()}_draw(e){const{_sketch:t}=this;this._reset(),this._drawState=e,t.create("text"===e?"point":e)}_createEvent(e){const{_drawState:t,_sketch:{layer:i},text:o,_newTextInput:a}=this,{state:n,graphic:l}=e;if("cancel"===n)return void this._reset();if("complete"!==n)return;const s=l.geometry.type;i.remove(l),"text"===t==!0?o.add(l):this[s].add(l),"text"===t&&(this._viewState="text",setTimeout((()=>{a.selectText()}),100),this._newTextGraphic=l),this._drawState="ready"}_newText(e){e.preventDefault(),this._viewState="markup",this._newTextInput.value="New text"}_addGeometry(e){const t=e.type;this[t].add(new h({geometry:e,symbol:this[`${t}Symbol`]}))}_editGeometry(e){const{_sketch:t,_sketch:{layer:i}}=this;e.layer.remove(e),i.add(e),t.update(e)}_updateEvent(e){const{_sketch:{layer:t},text:i}=this,{state:o,graphics:a}=e;if("complete"!==o)return;const n=a[0],l=n.geometry.type,s=n.symbol.type;t.removeAll(),"text"===s?i.add(n):this[l].add(n),this._selectReset(),this._viewState="markup"}_delete(){const{_sketch:e,_selectedGraphic:t}=this;t&&(e.complete(),t.layer.remove(t),this._viewState="markup",this._selectReset())}_selectReset(){const{_selectHandle:e}=this;e&&(e.remove(),this._selectHandle=null),this._textClearSelection(),this._selectedGraphic=null,this._selectState=!1,this.hasHandles(F)&&this.removeHandles(F)}_clearSelection(){this._textClearSelection(),this._reset(),this._viewState="markup"}_textClearSelection(){const{_selectedGraphic:e}=this;if(e&&"text"===e.symbol.type&&!e.symbol.text){const t=e.symbol.clone();t.text="New Text",e.symbol=t}}_select(){const{view:t,view:{popup:i},point:o,polyline:a,polygon:s,text:c,_selectState:r}=this;this._selectState=!r,this._selectState?(i.close(),i.clear&&"function"==typeof i.clear&&i.clear(),this._selectHandle=t.on("click",(i=>e(this,void 0,void 0,(function*(){i.stopPropagation(),this.hasHandles(F)&&this.removeHandles(F);const e=(yield t.hitTest(i,{include:[o,a,s,c]})).results;if(!e.length)return this._viewState="markup",void(this._selectedGraphicsItems=new l);1===e.length?this._selectGraphic(e[0].graphic):(this._selectedGraphicsItems=new l(e.map((e=>{const{graphic:t,graphic:{geometry:{type:i},symbol:{type:o}},layer:{title:a}}=e;this.addHandles(this[`_${a}View`].highlight(t),F);const l="text"===o?"text-large":"point"===i?"point":"polyline"===i?"line":"polygon-vertices";return n("calcite-list-item",{key:A++,label:a.charAt(0).toUpperCase()+a.slice(1),onclick:this._selectGraphic.bind(this,t),onmouseenter:this._highlightSelected.bind(this,t),onmouseleave:this._unhighlightSelected.bind(this)},n("calcite-icon",{icon:l,scale:"s",slot:"content-end"}))}))),this._viewState="features",this.scheduleRender())}))))):this._reset()}_selectGraphic(e){const{_symbolEditorContainer:t,_symbolEditor:i}=this;this.hasHandles(F)&&this.removeHandles(F),this._selectedGraphic=e,this._editGeometry(e),i&&this._symbolEditor.destroy(),this._symbolEditor=new b({graphic:e,container:document.createElement("div")}),t.append(this._symbolEditor.container),this._viewState="feature",this._selectState=!1}_highlightSelected(e){const{_sketch:{layer:t}}=this,{geometry:i,symbol:o}=e,a=new p([0,255,0]),n=new p([0,255,0,.75]),l=o.clone();switch(l.type){case"simple-marker":case"simple-fill":Object.assign(l,{color:n,outline:{color:a}});break;case"simple-line":Object.assign(l,{color:n});break;case"text":Object.assign(l,{color:a})}this._highlightedGraphic=new h({geometry:i,symbol:l}),t.add(this._highlightedGraphic)}_unhighlightSelected(){const{_sketch:{layer:e},_highlightedGraphic:t}=this;t&&e.remove(t)}_buffer(){return e(this,void 0,void 0,(function*(){const{view:{spatialReference:e},bufferDistance:t,lengthUnit:i,_selectedGraphic:o,_selectedPopupFeature:a}=this,n=o||a;if(!n)return;const l=n.layer||n.sourceLayer;let s=n.geometry;if(s&&"point"===s.type)return this._addGeometry(k(s,t,i)),void this._cancelBufferOffset();l&&("graphics"!==l.type&&(s=yield v({layer:l,graphic:n,outSpatialReference:e})),this._addGeometry(k(s,t,i)),this._cancelBufferOffset())}))}_cancelBufferOffset(){const{_selectedGraphic:e}=this;this._viewState=e?"feature":"markup"}_offset(){return e(this,void 0,void 0,(function*(){const{view:{spatialReference:e},offsetDistance:t,offsetDirection:i,offsetProjectionWkid:o,lengthUnit:a,_selectedGraphic:n,_selectedPopupFeature:l}=this,s=n||l;if(!s)return;const c=s.layer||s.sourceLayer;let r=s.geometry;if(!c||"polyline"!==r.type)return;"graphics"!==c.type&&(r=yield v({layer:c,graphic:s,outSpatialReference:e}));(yield x(r,t,a,i,o,e)).forEach(this._addGeometry.bind(this)),this._cancelBufferOffset()}))}_addSelectedPopupFeature(){return e(this,void 0,void 0,(function*(){const{view:{popup:e,spatialReference:t}}=this;if(!e.selectedFeature)return;const i=e.selectedFeature,o=i.layer||i.sourceLayer;let a=i.geometry;a&&"point"===a.type?this._addGeometry(a):o&&(a=yield v({layer:o,graphic:i,outSpatialReference:t}),this._addGeometry(a))}))}_addVertices(){return e(this,void 0,void 0,(function*(){const{view:{spatialReference:e},_selectedGraphic:t,_selectedPopupFeature:i,_confirmVerticesModal:o,_confirmVerticesModalHandle:a}=this,n=t||i;if(!n)return;const l=n.layer||n.sourceLayer;if(!l)return;let s=n.geometry;if(!s||"point"===s.type)return;"graphics"!==l.type&&(s=yield v({layer:l,graphic:n,outSpatialReference:e}));const c=g(s);c>500&&!o&&(this._confirmVerticesModal=new((yield import("./Markup/ConfirmVerticesModal")).default)),c>500?(this._confirmVerticesModal.container.open=!0,a&&a.remove(),this._confirmVerticesModalHandle=this._confirmVerticesModal.on("confirmed",(t=>{t&&this.__addVertices(s,e)}))):this.__addVertices(s,e)}))}__addVertices(e,t){"polyline"===e.type&&w(e,t).forEach((e=>{this._addGeometry(e)})),"polygon"===e.type&&S(e,t).forEach((e=>{this._addGeometry(e)}))}_save(e){var t;e.preventDefault();const i=`${(null===(t=e.target.querySelector("calcite-input"))||void 0===t?void 0:t.value)||"my-markup"}.mjson`,o=JSON.stringify({graphics:this._allGraphicsJson()}),a=document.createElement("a");a.setAttribute("href",`data:text/json;charset=utf-8,${encodeURIComponent(o)}`),a.setAttribute("download",i),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),this._viewState="markup"}_allGraphicsJson(){const{text:e,point:t,polyline:i,polygon:o}=this;return[...this._layerGraphicsJson(e),...this._layerGraphicsJson(t),...this._layerGraphicsJson(i),...this._layerGraphicsJson(o)]}_layerGraphicsJson(e){return e.graphics.toArray().map((e=>e.toJSON()))}_load(t){return e(this,void 0,void 0,(function*(){t.preventDefault();const{_graphicsCount:e,_confirmLoadModal:i,_confirmLoadModalHandle:o}=this,a=t.target.querySelector("calcite-input");return a.status="idle",a.files?(e&&!i&&(this._confirmLoadModal=new((yield import("./Markup/ConfirmLoadModal")).default)),e?(this._confirmLoadModal.container.open=!0,o&&o.remove(),void(this._confirmLoadModalHandle=this._confirmLoadModal.on("confirmed",(e=>{e?this._loadGraphics(a):this._confirmLoadModal.container.open=!1})))):void this._loadGraphics(a)):(a.status="invalid",void a.setFocus())}))}_loadGraphics(t){return e(this,void 0,void 0,(function*(){const{view:e,text:i,point:o,polyline:a,polygon:n}=this;if(!t.files)return;const l=[],s=yield t.files[0].text(),c=JSON.parse(s);i.graphics.removeAll(),o.graphics.removeAll(),a.graphics.removeAll(),n.graphics.removeAll(),c.graphics.forEach((e=>{const t=h.fromJSON(e);if(l.push(t),"text"===t.symbol.type)i.add(t);else{this[t.geometry.type].add(t)}})),this._viewState="markup",e.goTo(l),t.files=void 0,t.value=""}))}_countGraphics(){const{text:e,point:t,polyline:i,polygon:o}=this;this._graphicsCount=e.graphics.length+t.graphics.length+i.graphics.length+o.graphics.length}_undoRedo(){const{_sketch:e}=this;this._canUndo=e.canUndo(),this._canRedo=e.canRedo()}render(){const{id:e,_sketch:t,_graphicsCount:i,_canUndo:o,_canRedo:a,_featureSnapping:l,_drawingGuides:s,_drawState:c,_selectState:r,_selectedGraphic:d,_selectedPopupFeature:h,_selectedGraphicsItems:p,_viewState:u}=this,f=`new_text_${e}`;return n("calcite-panel",{heading:"Markup"},n("calcite-action",{hidden:"markup"!==u,icon:"save",slot:"markup"===u?"header-actions-end":"",text:"Save/Load",onclick:()=>{this._viewState="save"}},n("calcite-tooltip",{"close-on-click":"",placement:"bottom",slot:"tooltip"},"Save/Load")),n("div",{hidden:"markup"!==u,class:G},n("div",{class:L},n("calcite-button",{id:this._tt(),appearance:r?"":"transparent",disabled:0===i,"icon-start":"cursor",onclick:this._select.bind(this)}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Select markup"),n("calcite-button",{id:this._tt(),appearance:"point"===c?"":"transparent","icon-start":"point",onclick:this._draw.bind(this,"point")}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Draw point"),n("calcite-button",{id:this._tt(),appearance:"polyline"===c?"":"transparent","icon-start":"line",onclick:this._draw.bind(this,"polyline")}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Draw polyline"),n("calcite-button",{id:this._tt(),appearance:"polygon"===c?"":"transparent","icon-start":"polygon-vertices",onclick:this._draw.bind(this,"polygon")}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Draw polygon"),n("calcite-button",{id:this._tt(),appearance:"rectangle"===c?"":"transparent","icon-start":"rectangle",onclick:this._draw.bind(this,"rectangle")}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Draw rectangle"),n("calcite-button",{id:this._tt(),appearance:"circle"===c?"":"transparent","icon-start":"circle",onclick:this._draw.bind(this,"circle")}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Draw circle"),n("calcite-button",{id:this._tt(),appearance:"text"===c?"":"transparent","icon-start":"text-large",onclick:this._draw.bind(this,"text")}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Draw text")),n("div",{class:E,hidden:"markup"===u&&"ready"===c},n("div",{class:L},n("calcite-button",{id:this._tt(),disabled:!o,appearance:"transparent","icon-start":"undo",onclick:t.undo.bind(t)}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Undo"),n("calcite-button",{id:this._tt(),disabled:!a,appearance:"transparent","icon-start":"redo",onclick:t.redo.bind(t)}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Redo")),n("calcite-label",{class:E,layout:"inline"},n("calcite-switch",{checked:l,afterCreate:this._featureSnappingAfterCreate.bind(this)}),"Feature snapping"),n("calcite-label",{layout:"inline",style:"--calcite-label-margin-bottom: 0;"},n("calcite-switch",{checked:s,afterCreate:this._drawingGuidesAfterCreate.bind(this)}),"Drawing guides")),n("div",{hidden:!h,class:C},"Selected feature options"),n("div",{hidden:!h,class:L},n("calcite-button",{id:this._tt(),appearance:"transparent","icon-start":"add-layer",onclick:this._addSelectedPopupFeature.bind(this)}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Add feature"),n("calcite-button",{id:this._tt(),hidden:"point"===(null==h?void 0:h.geometry.type),appearance:"transparent","icon-start":"vertex-plus",onclick:this._addVertices.bind(this)}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Add vertices"),n("calcite-button",{id:this._tt(),appearance:"transparent","icon-start":"rings",onclick:()=>{this._viewState="buffer"}}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Buffer"),n("calcite-button",{class:D,id:this._tt(),hidden:"polyline"!==(null==h?void 0:h.geometry.type),appearance:"transparent","icon-start":"hamburger",onclick:()=>{this._viewState="offset"}}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Offset"))),n("div",{hidden:"text"!==u,class:G},n("form",{id:f,onsubmit:this._newText.bind(this)},n("calcite-label",null,"Add text",n("calcite-input",{type:"text",value:"New text",afterCreate:this._newTextAfterCreate.bind(this)})))),n("calcite-button",{appearance:"outline",form:f,hidden:"text"!==u,slot:"text"===u?"footer":null,type:"submit",width:"full"},"Done"),n("div",{hidden:"features"!==u},n("calcite-notice",{class:O,open:"",scale:"s"},n("div",{slot:"message"},p.length," markup selected"),n("calcite-link",{slot:"link",onclick:this._clearSelection.bind(this)},"Clear selection")),n("calcite-list",null,p.toArray())),n("div",{hidden:"feature"!==u,class:G},n("div",{class:L},n("calcite-button",{id:this._tt(),disabled:!o,appearance:"transparent","icon-start":"undo",onclick:t.undo.bind(t)}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Undo"),n("calcite-button",{id:this._tt(),disabled:!a,appearance:"transparent","icon-start":"redo",onclick:t.redo.bind(t)}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Redo"),n("calcite-button",{id:this._tt(),appearance:"transparent","icon-start":"trash",onclick:this._delete.bind(this)}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Delete"),n("calcite-button",{id:this._tt(),hidden:"point"===(null==d?void 0:d.geometry.type),appearance:"transparent","icon-start":"vertex-plus",onclick:this._addVertices.bind(this)}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Add vertices"),n("calcite-button",{id:this._tt(),appearance:"transparent","icon-start":"rings",onclick:()=>{this._viewState="buffer"}}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Buffer"),n("calcite-button",{class:D,id:this._tt(),hidden:"polyline"!==(null==d?void 0:d.geometry.type),appearance:"transparent","icon-start":"hamburger",onclick:()=>{this._viewState="offset"}}),n("calcite-tooltip",{"close-on-click":"",placement:"bottom","reference-element":this._ttr()},"Offset")),n("div",{afterCreate:e=>{this._symbolEditorContainer=e}})),n("calcite-button",{appearance:"outline",hidden:"feature"!==u,slot:"feature"===u?"footer":null,width:"full",onclick:this._clearSelection.bind(this)},"Done"),n("div",{hidden:"buffer"!==u,class:G},n("calcite-label",null,"Distance",n("calcite-input",{type:"number",afterCreate:this._bufferDistanceAfterCreate.bind(this)})),n("calcite-label",null,"Unit",n("calcite-select",{afterCreate:this._unitSelectAfterCreate.bind(this)},this._renderUnitOptions(this.lengthUnits,this.lengthUnit)))),n("calcite-button",{hidden:"buffer"!==u,slot:"buffer"===u?"footer":null,width:"full",onclick:this._buffer.bind(this)},"Buffer"),n("calcite-button",{appearance:"outline",hidden:"buffer"!==u,slot:"buffer"===u?"footer":null,width:"full",onclick:this._cancelBufferOffset.bind(this)},"Cancel"),n("div",{hidden:"offset"!==u,class:G},n("calcite-label",null,"Distance",n("calcite-input",{type:"number",afterCreate:this._offsetDistanceAfterCreate.bind(this)})),n("calcite-label",null,"Unit",n("calcite-select",{afterCreate:this._unitSelectAfterCreate.bind(this)},this._renderUnitOptions(this.lengthUnits,this.lengthUnit))),n("calcite-label",null,"Direction",n("calcite-segmented-control",{afterCreate:this._offsetDirectionAfterCreate.bind(this)},n("calcite-segmented-control-item",{value:"both"},"Both"),n("calcite-segmented-control-item",{value:"left"},"Left"),n("calcite-segmented-control-item",{value:"right"},"Right")))),n("calcite-button",{hidden:"offset"!==u,slot:"offset"===u?"footer":null,width:"full",onclick:this._offset.bind(this)},"Offset"),n("calcite-button",{appearance:"outline",hidden:"offset"!==u,slot:"offset"===u?"footer":null,width:"full",onclick:this._cancelBufferOffset.bind(this)},"Cancel"),n("div",{hidden:"save"!==u},n("calcite-tabs",{class:M},n("calcite-tab-nav",{slot:"title-group"},n("calcite-tab-title",{selected:""},"Save"),n("calcite-tab-title",null,"Load")),n("calcite-tab",{selected:""},n("form",{onsubmit:this._save.bind(this)},n("calcite-label",null,"File name",n("calcite-input",{disabled:0===i,type:"text","suffix-text":".mjson",value:"my-markup"})),n("calcite-button",{disabled:0===i,type:"submit"},"Save Markup"))),n("calcite-tab",null,n("form",{onsubmit:this._load.bind(this)},n("calcite-label",null,".mjson file",n("calcite-input",{type:"file",accept:".mjson"})),n("calcite-button",{type:"submit"},"Load Markup"))))),n("calcite-button",{appearance:"outline",hidden:"save"!==u,slot:"save"===u?"footer":null,width:"full",onclick:()=>{this._viewState="markup"}},"Done"))}_newTextAfterCreate(e){this._newTextInput=e,e.addEventListener("calciteInputInput",(()=>{const{_newTextGraphic:t}=this;if(!t)return;const i=t.symbol.clone();i.text=e.value,t.symbol=i})),this.addHandles(this.watch("_viewState",((e,t)=>{const{_newTextGraphic:i}=this;if(!i)return;const o=i.symbol.clone();"text"!==t||o.text||(o.text="New Text",i.symbol=o)})))}_featureSnappingAfterCreate(e){e.addEventListener("calciteSwitchChange",(()=>{this._featureSnapping=e.checked}))}_drawingGuidesAfterCreate(e){e.addEventListener("calciteSwitchChange",(()=>{this._drawingGuides=e.checked}))}_bufferDistanceAfterCreate(e){e.value=this.bufferDistance.toString(),e.addEventListener("calciteInputInput",(()=>{this.bufferDistance=parseFloat(e.value)}))}_offsetDistanceAfterCreate(e){e.value=this.offsetDistance.toString(),e.addEventListener("calciteInputInput",(()=>{this.offsetDistance=parseFloat(e.value)}))}_offsetDirectionAfterCreate(e){e.querySelectorAll("calcite-segmented-control-item").forEach((e=>{e.value===this.offsetDirection&&(e.checked=!0)})),e.addEventListener("calciteSegmentedControlChange",(()=>{this.offsetDirection=e.selectedItem.value}))}_unitSelectAfterCreate(e){e.addEventListener("calciteSelectChange",(()=>{this.lengthUnit=e.selectedOption.value}))}_renderUnitOptions(e,t){const i=[];for(const o in e)i.push(n("calcite-option",{key:A++,label:e[o],value:o,selected:o===t}));return i}_tt(){return V}_ttr(){const{id:e}=this,t=V;return V=`tt_${e}_${R++}`,t}};t([o({aliasOf:"_sketch.pointSymbol"})],U.prototype,"pointSymbol",void 0),t([o({aliasOf:"_sketch.polylineSymbol"})],U.prototype,"polylineSymbol",void 0),t([o({aliasOf:"_sketch.polygonSymbol"})],U.prototype,"polygonSymbol",void 0),t([o({aliasOf:"_sketch.activeLineSymbol"})],U.prototype,"_activeLineSymbol",void 0),t([o({aliasOf:"_sketch.activeVertexSymbol"})],U.prototype,"_activeVertexSymbol",void 0),t([o({aliasOf:"_sketch.vertexSymbol"})],U.prototype,"_vertexSymbol",void 0),t([o({aliasOf:"_sketch.activeFillSymbol"})],U.prototype,"_activeFillSymbol",void 0),t([o({aliasOf:"_sketch.snappingOptions.featureEnabled"})],U.prototype,"_featureSnapping",void 0),t([o({aliasOf:"_sketch.snappingOptions.selfEnabled"})],U.prototype,"_drawingGuides",void 0),t([o()],U.prototype,"_drawState",void 0),t([o()],U.prototype,"_selectState",void 0),t([o()],U.prototype,"_selectedGraphic",void 0),t([o()],U.prototype,"_selectedPopupFeature",void 0),t([o()],U.prototype,"_graphicsCount",void 0),t([o()],U.prototype,"_canUndo",void 0),t([o()],U.prototype,"_canRedo",void 0),t([o()],U.prototype,"_viewState",void 0),U=t([i("cov.widgets.Markup")],U);export default U;